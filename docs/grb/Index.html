<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NationPulse | Country State & Dynamics</title>
    <style>
        /* --- CSS VARIABLES & RESET --- */
        :root {
            --bg-body: #f4f6f9;
            --bg-panel: #ffffff;
            --text-main: #1f2937;
            --text-muted: #6b7280;
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --accent-purple: #8b5cf6;
            --accent-teal: #14b8a6;
            --accent-rose: #f43f5e;
            --border: #e5e7eb;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-body);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* --- LAYOUT --- */
        .app-container {
            display: flex;
            width: 100%;
            height: 100%;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background-color: #111827; /* Dark sidebar */
            color: white;
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
            flex-shrink: 0;
            transition: transform 0.3s ease;
            z-index: 10;
        }

        .brand {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 2.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--primary);
        }
        
        .brand span { color: white; }

        .nav-links {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .nav-item {
            padding: 0.75rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #d1d5db;
            font-weight: 500;
        }

        .nav-item:hover, .nav-item.active {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            position: relative;
        }

        /* Header */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .page-title h1 {
            font-size: 1.75rem;
            font-weight: 700;
        }
        
        .page-title p {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-top: 4px;
        }

        .controls {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            border: 1px solid var(--border);
            background: white;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background-color: #f9fafb;
            border-color: #d1d5db;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
            border: none;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
        }

        /* --- GRID DASHBOARD --- */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: auto auto 1fr;
            gap: 1.5rem;
        }

        /* KPI Cards */
        .kpi-card {
            background: var(--bg-panel);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .kpi-title {
            font-size: 0.85rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-main);
        }

        .kpi-trend {
            font-size: 0.85rem;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .trend-up { color: var(--accent-teal); }
        .trend-down { color: var(--accent-rose); }

        /* Chart Containers */
        .chart-card {
            background: var(--bg-panel);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border);
            position: relative;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .chart-title {
            font-weight: 600;
            font-size: 1.1rem;
        }

        /* Custom SVG Chart Styles */
        .svg-chart-container {
            width: 100%;
            height: 300px;
            position: relative;
        }

        svg {
            width: 100%;
            height: 100%;
            overflow: visible;
        }

        .chart-line {
            fill: none;
            stroke: var(--primary);
            stroke-width: 3;
            stroke-linecap: round;
            stroke-linejoin: round;
            filter: drop-shadow(0 4px 3px rgba(59, 130, 246, 0.3));
            transition: d 0.5s ease; /* Smooth morphing */
        }

        .chart-area {
            fill: url(#gradientPrimary);
            opacity: 0.2;
            transition: d 0.5s ease;
        }

        .chart-axis {
            stroke: #e5e7eb;
            stroke-width: 1;
        }

        .chart-grid {
            stroke: #f3f4f6;
            stroke-dasharray: 4, 4;
        }

        .chart-tooltip {
            position: absolute;
            background: rgba(17, 24, 39, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            transform: translate(-50%, -100%);
            white-space: nowrap;
            z-index: 100;
        }

        .chart-point {
            fill: white;
            stroke: var(--primary);
            stroke-width: 2;
            cursor: pointer;
            transition: r 0.2s, stroke-width 0.2s;
        }
        
        .chart-point:hover {
            r: 6;
            stroke-width: 3;
        }

        /* --- INTERACTIVE MAP GRID --- */
        .map-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            gap: 8px;
            margin-top: 1rem;
        }

        .map-region {
            aspect-ratio: 1;
            background-color: #e5e7eb;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .map-region:hover {
            transform: scale(1.1);
            z-index: 2;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* Heatmap colors based on data intensity (assigned via JS) */
        .heat-low { background-color: #d1fae5; } /* Teal 100 */
        .heat-med { background-color: #3b82f6; } /* Blue 500 */
        .heat-high { background-color: #8b5cf6; } /* Purple 500 */
        .heat-crit { background-color: #f43f5e; } /* Rose 500 */

        /* --- BARS (Demographics) --- */
        .bar-chart-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .bar-label {
            width: 100px;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .bar-track {
            flex: 1;
            background: #f3f4f6;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .bar-fill {
            height: 100%;
            background: var(--primary);
            width: 0%;
            border-radius: 4px;
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .bar-value {
            width: 50px;
            text-align: right;
            font-size: 0.85rem;
            font-weight: 600;
        }

        /* --- RESPONSIVE --- */
        @media (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .app-container { flex-direction: column; }
            .sidebar { 
                width: 100%; 
                height: auto; 
                padding: 1rem;
                flex-direction: row; 
                justify-content: space-between;
                align-items: center;
            }
            .nav-links { 
                flex-direction: row; 
                display: none; /* Hide nav links on mobile for simplicity, or implement hamburger */
            }
            .dashboard-grid { grid-template-columns: 1fr; }
            .main-content { padding: 1rem; }
            .svg-chart-container { height: 250px; }
        }
    </style>
</head>
<body>

<div class="app-container">
    <!-- SIDEBAR -->
    <nav class="sidebar">
        <div class="brand">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 3v18h18"/><path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/>
            </svg>
            <span>NationPulse</span>
        </div>
        <ul class="nav-links">
            <li class="nav-item active" onclick="switchTab('overview')">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7"></rect>
                    <rect x="14" y="3" width="7" height="7"></rect>
                    <rect x="14" y="14" width="7" height="7"></rect>
                    <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
                Overview
            </li>
            <li class="nav-item" onclick="switchTab('economy')">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="1" x2="12" y2="23"></line>
                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                </svg>
                Economy
            </li>
            <li class="nav-item" onclick="switchTab('society')">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
                Society
            </li>
            <li class="nav-item" onclick="switchTab('settings')">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                </svg>
                Settings
            </li>
        </ul>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="main-content">
        <header class="top-bar">
            <div class="page-title">
                <h1 id="page-header">National Overview</h1>
                <p id="current-date">Updated: Just now</p>
            </div>
            <div class="controls">
                <button class="btn" onclick="randomizeData()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M23 4v6h-6"></path><path d="M1 20v-6h6"></path>
                        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                    </svg>
                    Simulate Live Data
                </button>
                <button class="btn btn-primary">Export Report</button>
            </div>
        </header>

        <div class="dashboard-grid">
            <!-- KPI 1 -->
            <div class="kpi-card">
                <div>
                    <div class="kpi-title">Total Population</div>
                    <div class="kpi-value" id="kpi-pop">12,405,200</div>
                </div>
                <div class="kpi-trend trend-up">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>
                    <span>+1.2% vs last year</span>
                </div>
            </div>

            <!-- KPI 2 -->
            <div class="kpi-card">
                <div>
                    <div class="kpi-title">GDP Growth</div>
                    <div class="kpi-value" id="kpi-gdp">3.8%</div>
                </div>
                <div class="kpi-trend trend-up">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>
                    <span>+0.4% vs last Q</span>
                </div>
            </div>

            <!-- KPI 3 -->
            <div class="kpi-card">
                <div>
                    <div class="kpi-title">Unemployment</div>
                    <div class="kpi-value" id="kpi-unemp">4.2%</div>
                </div>
                <div class="kpi-trend trend-down">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"></polyline><polyline points="17 18 23 18 23 12"></polyline></svg>
                    <span>-0.1% vs last month</span>
                </div>
            </div>

            <!-- KPI 4 -->
            <div class="kpi-card">
                <div>
                    <div class="kpi-title">Energy Index</div>
                    <div class="kpi-value" id="kpi-energy">89.4</div>
                </div>
                <div class="kpi-trend trend-up">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>
                    <span>Stable Output</span>
                </div>
            </div>

            <!-- Main Chart: GDP & Trends -->
            <div class="chart-card" style="grid-column: span 3;">
                <div class="chart-header">
                    <div class="chart-title">Economic Growth & Revenue Dynamics</div>
                    <select class="btn" id="chart-filter">
                        <option>Last 6 Months</option>
                        <option>Year to Date</option>
                        <option>5 Years</option>
                    </select>
                </div>
                <div class="svg-chart-container" id="main-chart-container">
                    <div class="chart-tooltip" id="tooltip"></div>
                    <svg preserveAspectRatio="none" viewBox="0 0 1000 300">
                        <defs>
                            <linearGradient id="gradientPrimary" x1="0" x2="0" y1="0" y2="1">
                                <stop offset="0%" stop-color="#3b82f6"/>
                                <stop offset="100%" stop-color="#3b82f6" stop-opacity="0"/>
                            </linearGradient>
                        </defs>
                        <!-- Grid Lines -->
                        <g class="grid"></g>
                        <!-- Chart Paths -->
                        <path class="chart-area" d="" />
                        <path class="chart-line" d="" />
                        <!-- Interactive Points -->
                        <g class="points"></g>
                    </svg>
                </div>
            </div>

            <!-- Side Widget: Regional Heatmap -->
            <div class="chart-card" style="grid-column: span 1;">
                <div class="chart-header">
                    <div class="chart-title">Regional Intensity</div>
                </div>
                <div id="region-map" class="map-grid">
                    <!-- JS will generate grid items here -->
                </div>
                <div style="margin-top:1rem; font-size:0.8rem; display:flex; justify-content:space-between; color:var(--text-muted);">
                    <span>Low Activity</span>
                    <div style="display:flex; gap:4px;">
                        <div style="width:10px; height:10px; background:#d1fae5; border-radius:2px;"></div>
                        <div style="width:10px; height:10px; background:#3b82f6; border-radius:2px;"></div>
                        <div style="width:10px; height:10px; background:#8b5cf6; border-radius:2px;"></div>
                        <div style="width:10px; height:10px; background:#f43f5e; border-radius:2px;"></div>
                    </div>
                    <span>High Activity</span>
                </div>
            </div>

            <!-- Bottom Chart: Demographics -->
            <div class="chart-card" style="grid-column: span 2;">
                <div class="chart-header">
                    <div class="chart-title">Demographic Distribution (Age Groups)</div>
                </div>
                <div id="demographics-container">
                    <!-- Bars injected via JS -->
                </div>
            </div>

            <!-- Bottom Widget: Sector Split -->
            <div class="chart-card" style="grid-column: span 2;">
                <div class="chart-header">
                    <div class="chart-title">Sector Performance</div>
                </div>
                <div style="display:flex; justify-content:center; align-items:center; height:200px; position:relative;">
                    <!-- CSS Donut Chart -->
                    <div style="width:160px; height:160px; border-radius:50%; background: conic-gradient(
                        var(--primary) 0% 40%, 
                        var(--accent-purple) 40% 70%, 
                        var(--accent-teal) 70% 90%, 
                        var(--accent-rose) 90% 100%
                    ); position:relative;"></div>
                    <div style="position:absolute; width:120px; height:120px; background:white; border-radius:50%; display:flex; align-items:center; justify-content:center; flex-direction:column;">
                        <span style="font-size:1.5rem; font-weight:700;">Total</span>
                        <span style="font-size:0.8rem; color:gray;">100%</span>
                    </div>
                </div>
                <div style="display:flex; justify-content:space-around; margin-top:1rem; font-size:0.85rem;">
                    <div style="display:flex; align-items:center; gap:5px;"><span style="width:10px; height:10px; background:var(--primary);"></span> Services</div>
                    <div style="display:flex; align-items:center; gap:5px;"><span style="width:10px; height:10px; background:var(--accent-purple);"></span> Industry</div>
                    <div style="display:flex; align-items:center; gap:5px;"><span style="width:10px; height:10px; background:var(--accent-teal);"></span> Agri</div>
                    <div style="display:flex; align-items:center; gap:5px;"><span style="width:10px; height:10px; background:var(--accent-rose);"></span> Tech</div>
                </div>
            </div>

        </div>
    </main>
</div>

<script>
    /* --- DATA MODEL --- */
    // Initial data for the line chart (6 months)
    let chartData = [
        { label: 'Jan', value: 45 },
        { label: 'Feb', value: 52 },
        { label: 'Mar', value: 48 },
        { label: 'Apr', value: 65 },
        { label: 'May', value: 58 },
        { label: 'Jun', value: 75 }
    ];

    const demographics = [
        { label: '0-14 Years', value: 22, color: '#3b82f6' },
        { label: '15-24 Years', value: 15, color: '#8b5cf6' },
        { label: '25-54 Years', value: 45, color: '#14b8a6' },
        { label: '55-64 Years', value: 10, color: '#f43f5e' },
        { label: '65+ Years', value: 8, color: '#6b7280' }
    ];

    /* --- CHARTING ENGINE (SVG) --- */
    function renderLineChart(data) {
        const svg = document.querySelector('svg');
        const width = 1000;
        const height = 300;
        const padding = 20;
        const maxVal = 100; // Fixed scale for demo

        // Calculate points
        const points = data.map((d, i) => {
            const x = padding + (i / (data.length - 1)) * (width - padding * 2);
            const y = height - padding - (d.value / maxVal) * (height - padding * 2);
            return { x, y, ...d };
        });

        // Generate Path Command (d attribute)
        let pathD = `M ${points[0].x} ${points[0].y}`;
        points.slice(1).forEach(p => {
            // Curve smoothing using Bezier control points
            const prev = points[points.indexOf(p) - 1];
            const cp1x = prev.x + (p.x - prev.x) / 2;
            const cp1y = prev.y;
            const cp2x = prev.x + (p.x - prev.x) / 2;
            const cp2y = p.y;
            pathD += ` C ${cp1x} ${cp1y}, ${cp2x} ${cp2y}, ${p.x} ${p.y}`;
        });

        // Update Line
        document.querySelector('.chart-line').setAttribute('d', pathD);

        // Update Area (close the path at the bottom)
        const areaD = pathD + ` L ${points[points.length-1].x} ${height} L ${points[0].x} ${height} Z`;
        document.querySelector('.chart-area').setAttribute('d', areaD);

        // Update Points
        const pointsGroup = document.querySelector('.points');
        pointsGroup.innerHTML = ''; // Clear old points
        
        points.forEach((p, index) => {
            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            circle.setAttribute('cx', p.x);
            circle.setAttribute('cy', p.y);
            circle.setAttribute('r', 4);
            circle.classList.add('chart-point');
            
            // Hover Interaction
            circle.addEventListener('mouseenter', (e) => showTooltip(e, p.label, p.value));
            circle.addEventListener('mouseleave', hideTooltip);
            
            pointsGroup.appendChild(circle);
        });

        // Draw Grid Lines (Horizontal)
        const gridGroup = document.querySelector('.grid');
        gridGroup.innerHTML = '';
        for(let i=0; i<=4; i++) {
            const y = padding + (i/4) * (height - padding*2);
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('x1', padding);
            line.setAttribute('y1', y);
            line.setAttribute('x2', width - padding);
            line.setAttribute('y2', y);
            line.classList.add('chart-grid');
            gridGroup.appendChild(line);
        }
    }

    /* --- TOOLTIP LOGIC --- */
    const tooltip = document.getElementById('tooltip');
    function showTooltip(e, label, value) {
        const rect = e.target.getBoundingClientRect();
        const containerRect = document.getElementById('main-chart-container').getBoundingClientRect();
        
        tooltip.innerHTML = `<strong>${label}</strong><br>Value: ${value}`;
        tooltip.style.left = (rect.left - containerRect.left + 5) + 'px';
        tooltip.style.top = (rect.top - containerRect.top - 10) + 'px';
        tooltip.style.opacity = 1;
    }

    function hideTooltip() {
        tooltip.style.opacity = 0;
    }

    /* --- DEMOGRAPHICS BAR CHART --- */
    function renderDemographics() {
        const container = document.getElementById('demographics-container');
        container.innerHTML = '';

        demographics.forEach(demo => {
            const row = document.createElement('div');
            row.className = 'bar-chart-row';
            row.innerHTML = `
                <div class="bar-label">${demo.label}</div>
                <div class="bar-track">
                    <div class="bar-fill" style="width: ${demo.value}%; background-color: ${demo.color}"></div>
                </div>
                <div class="bar-value">${demo.value}%</div>
            `;
            container.appendChild(row);
        });
    }

    /* --- INTERACTIVE REGION MAP --- */
    function initMap() {
        const mapContainer = document.getElementById('region-map');
        // Create 32 random regions
        for(let i=0; i<32; i++) {
            const div = document.createElement('div');
            div.className = 'map-region';
            
            // Assign random heat class
            const rand = Math.random();
            let heatClass = 'heat-low';
            if(rand > 0.7) heatClass = 'heat-med';
            if(rand > 0.9) heatClass = 'heat-high';
            if(rand > 0.96) heatClass = 'heat-crit';
            
            div.classList.add(heatClass);
            
            // Click interaction
            div.onclick = function() {
                // Reset others
                document.querySelectorAll('.map-region').forEach(el => el.style.borderColor = 'transparent');
                // Highlight selected
                this.style.borderColor = '#1f2937';
                this.style.borderWidth = '2px';
                
                // Update page title dynamically to simulate drill-down
                document.getElementById('page-header').innerText = `Region Detail: Sector ${i+1}`;
            };

            mapContainer.appendChild(div);
        }
    }

    /* --- DYNAMIC DATA SIMULATION --- */
    function randomizeData() {
        // Update Line Chart Data
        chartData = chartData.map(d => ({
            label: d.label,
            value: Math.floor(Math.random() * 60) + 20 // Random value between 20 and 80
        }));
        renderLineChart(chartData);

        // Update KPI Numbers with a simple animation effect
        animateValue("kpi-pop", 12000000, 13000000, "$");
        animateValue("kpi-gdp", 2.0, 5.0, "", "%");
        animateValue("kpi-unemp", 3.0, 7.0, "", "%");
        
        // Refresh Map
        const mapContainer = document.getElementById('region-map');
        mapContainer.innerHTML = '';
        initMap();

        // Update Demographics slightly
        demographics.forEach(d => {
            d.value = Math.max(5, Math.min(60, d.value + (Math.random() * 10 - 5)));
        });
        renderDemographics();
    }

    // Helper to animate numbers
    function animateValue(id, min, max, prefix, suffix = "") {
        const obj = document.getElementById(id);
        const target = Math.floor(Math.random() * (max - min + 1) + min);
        
        // Formatting logic
        let finalStr = target.toLocaleString();
        if(id === 'kpi-gdp' || id === 'kpi-unemp') finalStr = target.toFixed(1); // Keep float

        obj.innerText = prefix + finalStr + suffix;

        // Visual flash effect
        obj.style.color = 'var(--primary)';
        setTimeout(() => obj.style.color = 'var(--text-main)', 300);
    }

    /* --- NAVIGATION TABS --- */
    function switchTab(tabName) {
        // Update active state in sidebar
        document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
        event.currentTarget.classList.add('active');

        // In a real app, this would hide/show sections.
        // Here we just update the header title to simulate navigation.
        const titles = {
            'overview': 'National Overview',
            'economy': 'Economic Indicators',
            'society': 'Social Dynamics',
            'settings': 'System Configuration'
        };
        document.getElementById('page-header').innerText = titles[tabName];
    }

    /* --- INITIALIZATION --- */
    window.onload = function() {
        // Set date
        const date = new Date();
        document.getElementById('current-date').innerText = "Updated: " + date.toLocaleDateString() + " " + date.toLocaleTimeString();

        renderLineChart(chartData);
        renderDemographics();
        initMap();

        // Add window resize listener for chart responsiveness (simple re-render)
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => renderLineChart(chartData), 200);
        });
    };

</script>
</body>
</html>